<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= data.user.role === "Admin"? "Admin":"User" %> - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 lg:flex lg:gap-5">

    <!-- navbar -->
    <%- include('./partials/navbar.ejs') %>

    <div class="flex relative">
        <!-- leftPane menu bar -->
        <%- include('./partials/leftPane.ejs', {data: {
            active: "dashboard",
            user: data.user
        }}) %>

        <!-- main content here -->
        <div id="content"
            class="h-[calc(100vh-4.1rem)] lg:ml-[300px] mt-[3.7rem] mx-auto w-11/12 max-w-maxContent overflow-auto">
                    
                <div class="mx-auto flex flex-col items-center w-11/12 max-w-[1000px] space-y-5 py-10">

                    <% if(data.user.role === "User") { %>
                        <h1 class="text-2xl font-semibold mt-5 text-center">User Dashboard</h1>
                        <div>
                            Your Department: <span class="font-semibold"><%= data?.dashboardData?.departmentName %></span>
                        </div>

                        <!-- cards to show stats counts -->
                        <div class="flex gap-5 flex-wrap justify-center items-center"> 
                            <div class="bg-white shadow-lg rounded-lg p-6 w-64 min-h-40 flex flex-col gap-3 justify-center items-center">
                                <div class="text-xl font-semibold text-gray-500">Total Tickets</div>
                                <div class="text-2xl font-bold text-gray-800"><%= data?.dashboardData?.totalTicketsAssined %></div>
                            </div>
                            <div class="bg-white text-gray-800 shadow-lg rounded-lg p-6 w-64 min-h-40 flex flex-col gap-3 justify-center items-center">
                                <div class="text-xl font-semibold text-gray-500">Open Tickets</div>
                                <div class="text-2xl font-bold"><%= data?.dashboardData?.statusCounts?.openCount %></div>
                            </div>
                            <div class="bg-white text-gray-800 shadow-lg rounded-lg p-6 w-64 min-h-40 flex flex-col gap-3 justify-center items-center">
                                <div class="text-xl font-semibold text-gray-500">In Progress Tickets</div>
                                <div class="text-2xl font-bold"><%= data?.dashboardData?.statusCounts?.inProgressCount %></div>
                            </div>
                            <div class="bg-white text-gray-800 shadow-lg rounded-lg p-6 w-64 min-h-40 flex flex-col gap-3 justify-center items-center">
                                <div class="text-xl font-semibold text-gray-500">Closed Tickets</div>
                                <div class="text-2xl font-bold"><%= data?.dashboardData?.statusCounts?.closedCount %></div>
                            </div>
                        </div>

                    <% } else if(data.user.role === "Admin") { %>
                        <h1 class="text-2xl font-semibold mt-5 text-center">Admin Dashboard</h1>
                        <div class="flex flex-col md:flex-row gap-5 mx-auto w-full">
                            <div class="flex flex-col gap-5 items-center">
                                <div class="bg-white shadow-lg rounded-lg p-6 w-64 min-h-40 flex flex-col gap-3 justify-center items-center">  
                                    <p>
                                        <span class="font-semibold">Total Departments: </span>
                                        <%= data?.dashboardData?.length %>
                                    </p>
                                    <p>
                                        <span class="font-semibold">Total Tickets: </span>
                                        <%= data?.dashboardData?.reduce((acc, curr) => acc + curr.totalTicketsAssined, 0) %>
                                    </p>
                                </div>
                    
                                <div class="bg-white shadow-lg rounded-lg p-6 w-64 min-h-40 flex flex-col gap-3 justify-center items-center">
                                    <p
                                    class="font-semibold">
                                    Department Names: </p>
                                    <ul class="list-disc list-inside">
                                        <% data?.dashboardData?.forEach((department) => { %>
                                            <% if(department.departmentName !== "Admin") { %> 
                                                <li><%= department.departmentName %></li>
                                            <% } %>
                                        <% }) %>
                                    </ul>
                                </div>
                            </div>

                            <!-- all dept stats cards-->
                            <div class="flex flex-wrap gap-5 justify-center">
                                <% data?.dashboardData?.forEach((department) => { %>
                                    <% if(department.departmentName !== "Admin") { %> 
                                        <div class="bg-white text-gray-800 shadow-lg rounded-lg px-6 py-4 w-64 min-h-40 flex flex-col gap-3">
                                            <div class="text-xl font-semibold text-gray-500"> 
                                                Department: <%= department.departmentName %>
                                            </div>
                                            <div class="text-base">
                                                Total Tickets Assigned: <span class="font-bold"><%= department.totalTicketsAssined %></span>
                                            </div>
                                            <div class="text-base">
                                                Open Tickets: <span class="font-bold"><%= department.statusCounts.openCount %></span>
                                            </div>
                                            <div class="text-base">
                                                In Progress Tickets: <span class="font-bold"><%= department.statusCounts.inProgressCount %></span>
                                            </div>
                                            <div class="text-base">
                                                Closed Tickets: <span class="font-bold"><%= department.statusCounts.closedCount %></span>
                                            </div>
                                        </div>
                                    <% } %>
                                <% }) %>
                            </div>  
                        </div>
                    <% } %>
            </div>
        </div>
    <div>
    <script src="/js/leftPane.js"></script>
    <script src="/js/profile.js"></script>

</body>
</html>